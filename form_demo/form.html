<!DOCTYPE html>
<html>
<head>
    <title> BG Submit Form </title>
</head>
<body>
<h1>Welcome to <b>Form</b></h1>
<p>This will be the form used for submitting strings</p>

<script>

</script>

<fieldset>
Pick what you want to document!
<form>
<input type="checkbox" name="bg" id="bg" value="bg" onclick="displayForm(this.id)"><label for="bg"> BG</label><br>
<input type="checkbox" name="food" id="food" value="food" onclick="displayForm(this.id)"><label for="food"> Food</label><br>
<input type="checkbox" name="insulin" id="insulin" value="insulin" onclick="displayForm(this.id)"><label for="insulin"> Insulin</label><br>
</form>
</fieldset>


<form method="post" id="bgForm" style="display:none">
<fieldset>
Blood Glucose:<br>
<input type="test" name="Blood Glucose" placeholder="Enter BG"><br>
Time:<br>
<input type="datetime-local" id="bg-time-input" name="time">
</fieldset>
</form>


<form method="post" id="foodForm" style="display:none">
<fieldset>
Food:<br>
<input type="text" name="food" placeholder="Enter food"><br>
Carbs(g):             
<input type="text" name="carbs" placeholder="Enter carbs"><br>
Protein(g):
<input type="text" name="protein" placeholder="Enter carbs"><br>
Fat(g):
<input type="text" name="protein" placeholder="Enter carbs"><br>
Time:<br>
<input type="datetime-local" id="food-time-input" name="time">
</fieldset>
</form>

<form method="post" id="insulinForm" style="display:none">
<fieldset>
Insulin Pump?:
<input type="radio" name="pump" id="yesPump" value="yes" onclick="displayForm(this.id, this.value, this.name)">Yes 
<input type="radio" name="pump" id="noPump" value="no" onclick="displayForm(this.id, this.value, this.name)">No
</form>

<form method="post" id="noPumpForm" style="display:none">
Short Acting Insulin Type: <br>
<!--This should be a user default -->
<input type="text" name="short insulin type" placeholder="Enter insulin type"> <br>
Time:<br>
<input type="datetime-local" id="insulin-time-input" name="time">
</form>

<form method="post" id="yesPumpForm" style="display:none">
Insulin Type: <br>
<input type="text" name="insulin type" placeholder="Enter insulin type"> <br>
Basal Program: <br>
<input type="datetime-local" id="basal-time-input" name="basalTime">
</form>
</fieldset>

<script>
//var s = new Date().toISOString();
//document.getElementById("time-input").defaultValue = s.slice(0, -5);
function setTime() {
	var tzOffset = new Date().getTimezoneOffset() * 60000;
	var localTime = new Date(Date.now() - tzOffset).toISOString().slice(0, -1);
	return(localTime)
}
// NOTE: the slice was used to convert from the ISO string I was getting to a format used by the HTML element
// I'm not sure the ISO string format I was getting is always gauranteed across browsers
// This seems to work for me but should be flagged as something to change later to make sure it always works

function displayForm(id, radioVal=null, radioName=null) {
    let check_status = document.getElementById(id);
	let displayValue = null
	if(check_status){
	    let formName = radioVal ? radioVal+capitalizeFirstLetter(id)+"Form" : id+"Form";
		console.log("Form name: " + formName);
	    if(check_status.type === "radio") {
		    //displayValue = document.getElementById(formName).checked === true ? "block" : "none";
			buttonSet = document.getElementsByName(radioName)
			showClickedRadioForm(id, buttonSet)
			//console.log("radio displayValue:" + displayValue)
		}
		else{
		    displayValue = check_status.checked ? "block" : "none";
			console.log("not radio displayValue: " + displayValue);
		}
	    //let formName = descriptor ? descriptor+capitalizeFirstLetter(id)+"Form" : id+"Form";
		//console.log("displayValue: " + displayValue);
		
		document.getElementById(formName).style.display = displayValue;
		if(displayValue === "block"){
		    document.getElementById(id +"-time-input").defaultValue = setTime();
		}
	}
}

function showClickedRadioForm(id, buttonSet) {
	//identify the clicked button
	let displayValue = null
    for (i=0; i<buttonSet.length; i++){
	    formName = buttonSet[i].id + "Form"
        if(buttonSet[i].checked === true){
		    //console.log("checked === true")
		    displayValue = "block"
            //updateTime		
		}
		else{
		    displayValue = "none"
		}
		console.log("radio Form Name: " + formName + "|| displayValue: " + displayValue)
		console.log("current display: " + document.getElementById(formName).style.display)
		document.getElementById(formName).style.display = displayValue
		console.log("post change display: " + document.getElementById(formName).style.display)
    }    
}

function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1)
}
</script>

<input type="submit" value="Submit">
</form>

</body>
</html>
