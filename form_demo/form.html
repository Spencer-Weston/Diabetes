<!DOCTYPE html>
<html>
<head>
    <title> BG Submit Form </title>
</head>
<body onload="initInsulinTypeValue()">
<h1>Welcome to <b>Form</b></h1>
<p>This will be the form used for submitting strings</p>

<script>
function test(){
    console.log("IGOTCALLED")
}

function displayForm(id) {
	console.log(id);
    let check_status = document.getElementById(id);
	if(check_status){
	    document.getElementById(id + "Form").style.display ="block";		
	}
}
</script>

<fieldset>
Pick what you want to document!
<form>
<input type="checkbox" name="bg" id="bg" value="bg" /><label for="bg"> BG</label><br>
<input type="checkbox" name="food" id="food" value="food"/><label onclick="test()" for="food"> Food</label><br>
<input type="checkbox" name="insulin" id="insulin" value="insulin" onclick="displayForm(this.id)"><label for="insulin"> Insulin</label><br>
</form>
</fieldset>

<form method="post" name="insulinForm" id="insulinForm" style="display:none">
<!-- input string -->
Blood Glucose:<br>
<input type="text" name="Blood Glucose" placeholder="Enter BG"><br>
Insulin Type: <br>
<!--This should be a user default -->
<input type="text" name="insulin type" id="insulinType" oninput="setInsulinTypeCookie(this.value)" placeholder="Enter insulin type"> <br>

Time:<br>
<input type="datetime-local" id="time-input" name="time">
<script>
//var s = new Date().toISOString();
//document.getElementById("time-input").defaultValue = s.slice(0, -5);

var tzOffset = new Date().getTimezoneOffset() * 60000;
var localTime = new Date(Date.now() - tzOffset).toISOString().slice(0, -1);
document.getElementById("time-input").defaultValue = localTime;

// NOTE: the slice was used to convert from the ISO string I was getting to a format used by the HTML element
// I'm not sure the ISO string format I was getting is always gauranteed across browsers
// This seems to work for me but should be flagged as something to change later to make sure it always works

function setInsulinTypeCookie(value) {
	let insulinType = value;
	document.cookie = "defaultInsulinType=" + insulinType;
}

function initInsulinTypeValue() {
	console.log('here')
	let element = document.getElementById("insulinType");
	let cookiePairs = document.cookie.split(';');
	let value = '';
	console.log(cookiePairs);

	let i;

	// check all cookies
	for (i = 0; i < cookiePairs.length; i += 1) {
		let pair = cookiePairs[i];
		console.log('pair:');
		console.log(pair);
		let cookie = pair.split('=');
		console.log(cookie);

		// find cookie pair with correct name
		if (cookie[0] === 'defaultInsulinType') {
			value = cookie[1];
			break;
		}
	}
	
	element.value = value;
}
</script>

<input type="submit" value="Submit">
</form>

</body>
</html>
